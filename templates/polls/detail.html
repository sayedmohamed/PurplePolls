{% extends "base.html" %}
{% block content %}

<h1>{{ poll.question }}</h1>

<form action="{% url 'polls:vote' poll.id %}" method="post">
{% csrf_token %}
{% for choice in poll.choice_set.all %}
    <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}" />
    <label for="choice{{ forloop.counter }}">{{ choice.choice_text }}</label><br />
{% endfor %}
<input type="submit" value="Vote" id="vote" />
</form>

<script type="text/javascript">
    $(document).ready(function() {
        $(vote).click(create_vote);
    });

    var create_vote = function() {
        var value = $("form input[name='choice']:checked").val();

        if (value != "")
        {
            var data = { choice:value };
            var args = { type:"POST", url:"/polls/{{ poll.id }}/vote/", data:data, complete:create_vote_complete };
            $.ajax(args);
        }
        else
        {
            // We should display a helpful error message
        }
        return false;
    };

    var create_vote_complete = function(res, status) {
        if (status == "success") {
            window.location.href = "/polls/{{ poll.id }}/results/";
        }
        else
        {
            display_message(res.responseText, $(".message"));
        }
    }

    var display_message = function(msg, elem) {
        var msg_div = $('<div><strong><p>'+msg+'</p></strong></div>');
        elem.append(msg_div).fadeIn('slow').animate({opacity: 1.0}, 7000);
    };

    $.ajaxSetup( {
            data: { csrfmiddlewaretoken: '{{csrf_token}}' },
        });


</script>


{% endblock %}