{% extends "base.html" %}
{% block content %}

    <h1>{{ poll.question }}</h1>

    <div class="menu"><a href="/polls/"> Back to polls list</a></div>
    <br />

    <div class="results">
    {% if voted %}
        {% include "polls/poll_detail_results.html" %}
    </div>
    <div class="poll_form">
    {% else %}
        {% include "polls/poll_detail_form.html" %}
    {% endif %}
    </div>

<script type="text/javascript">
    $(document).ready(function() {
        $('#vote').click(create_vote);
    });

    var create_vote = function(e) {
        e.preventDefault()
        var value = $("form input[name='choice']:checked").val();
        var data = { choice: value };
        var args = { type:"POST", url:"/polls/{{ poll.id }}/vote/", data:data, complete:create_vote_complete };
        $.ajax(args);
    };

    var create_vote_complete = function(res, status) {
        if (status == "success") {
            $(".results").html(res.responseText);
        }
    }

    $.ajaxSetup( {
            data: { csrfmiddlewaretoken: '{{csrf_token}}' },
        });
</script>

{% endblock %}